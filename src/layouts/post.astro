---
import type { CollectionEntry } from 'astro:content'
import MainLayout from '$/components/layouts/MainLayout.astro'
import BaseHead from '$/components/layouts/BaseHead.astro'
import Prose from '$/components/elements/Prose.astro'
import { ViewTransitions } from 'astro:transitions'
import TagList from '$/components/elements/TagList.astro'
import {
  calcTagCountByTagList,
  extractExcerptFromBody,
  formatPostDate,
} from '$/utils'
import PostIcon from '$/components/elements/postIcon.astro'

interface Props {
  entry: CollectionEntry<'owned'>
  enableTransition?: boolean
}
const { entry, enableTransition = false } = Astro.props
---

<!DOCTYPE html>
<html lang="ja">
  <head>
    <BaseHead
      title={entry.data.title}
      description={await extractExcerptFromBody(entry.body)}
    />
    {enableTransition && <ViewTransitions />}
  </head>
  <MainLayout isPostPage>
    {
      entry.data.tagList && entry.data.tagList[0] !== 'other' && (
        <PostIcon tag={entry.data.tagList[0]} link={entry.slug} />
      )
    }
    <div class="post__header">
      <div class="post__title-wrapper">
        <h1 class="post__title" transition:name={`title:${entry.slug}`}>
          {entry.data.title}
        </h1>
      </div>
      <div class:list={['post__info', entry.data.tagList && 'has-tag-list']}>
        {
          entry.data.tagList && (
            <TagList items={calcTagCountByTagList(entry.data.tagList)} />
          )
        }
        <span class="post__date">
          {formatPostDate(entry.data.pubDate)}
        </span>
      </div>
    </div>
    <Prose>
      <slot />
    </Prose>
  </MainLayout>

  <style>
    .post__header {
      @apply py-4 mb-1 text-center md:text-left;
    }
    .post__title-wrapper {
      @apply flex justify-center;
    }
    .post__title {
      @apply text-xl md:text-3xl text-left font-extrabold mt-5;
    }
    .post__info {
      @apply text-right mt-3;
      &.has-tag-list {
        @apply flex justify-between items-center;
      }
    }
    .post__date {
      @apply md:text-sm text-xs;
    }
    .post__tag-list {
      @apply flex justify-center;
    }
  </style>
</html>
